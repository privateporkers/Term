@{
    ViewData["Title"] = "Index";
}
<head>
    <script src="~/Scripts/p5.js" type="text/javascript"></script>
    <script src="~/Scripts/p5.dom.js" type="text/javascript"></script>
    <script src="~/Scripts/sketch.js" type="text/javascript"></script>
    <script src="~/Scripts/randomWord.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="~/Stylesheets/style.css">
    <link href="https://fonts.googleapis.com/css?family=Press+Start+2P" rel="stylesheet">
</head>

<body> 
    <div id="console">
        <script type="text/javascript">
            //Global Variables
            var input;
            var row;
            var termTable;
            var tableDiv;
            var test = false;
            var placeHolder;
            var echoChange;
            var wordCheck;
            var baseWord = "hello";
            var commandStrTwo;
            var wordBox;
            var word = pickRandomWord();
            var time = 0;
            var timeDisplay = 30;

            //Runs at the start of the program
            function setup() {
                noCanvas();

                var title = createDiv();
                title.parent('console');
                title.id('title');
                title.html('>TERM');

                wordBox = createDiv();
                wordBox.parent('console');
                wordBox.id('wordBox');
                wordBox.html(word);

                termTable = createElement('table');
                termTable.parent('console');

                placeHolder = createP('>');
                placeHolder.parent('console');

                tableDiv = createDiv();
                tableDiv.parent('console');
                tableDiv.id('bar');

                input = createInput();
                input.parent(tableDiv);

                input.elt.focus();

                input.changed(terminal);

                var border = createDiv();

                timer();
            }

            function gameOver() {
                termTable.remove();
                tableDiv.remove();
                input.remove();
                placeHolder.remove();

                var endGame = createP("GAME OVER");
                endGame.id('gameEnd');
                endGame.parent('console');

            }

            function timer() {
                time = 0;
                timeDisplay = 30;
                var countDown = createP('');
                for(var i = 0; i < 31; i++  ){

                    setTimeout(function(){ 
                        countDown.remove(); 
                        countDown = createP(timeDisplay); 
                        countDown.parent('wordBox');
                        timeDisplay--;

                        if(timeDisplay == -1){
                            gameOver();
                        }
                    }, time);

                    time += 1000;
                }
                
            }

            //Creates a new row with 'str' as output
            function createRow(str) {
                row = createElement('tr');
                row.parent(termTable);
                row.html(str);
            }

            //Runs when something is inputed through the input bar
            function terminal() {


                var command = input.value();
                command = command.trim();
                var index = command.indexOf(' ');
                commandStrTwo = command.substring(index + 1);
                var commandStrOne = command.substring(0, index);

                //Command conditionals
                if (commandStrOne == "echo") {
                    if (wordCheck()) {
                        echoCom(commandStrTwo);
                        if (commandStrTwo == word) {
                            test = false;
                            word = pickRandomWord();
                            wordBox.html(word);
                        }                    
                    }
                    else {
                        textChange(commandStrTwo);
                        echoCom(echoChange);
                    }
                }
                else if (command == "clear") {
                    clearCom();
                }
                else if (command == "help") {
                    helpCom();
                }
                else if (commandStrOne == "text") {
                    textCom(commandStrTwo);
                }
                else {
                    notCom(command);
                }

                input.value('');

            }
            

            //Text command / currently only changes a word with no vowels to having vowels - CHANGE -
            function textCom(str) {
                if (str == "vowels") {
                    test = true;
                    createRow('>text ' + str + ': Vowels added!');
                }
                else {
                    createRow('>text ' + str);
                }          
            }


            //Test command - CHANGE -
            function textChange(str) {
                //var rand = Math.trunc(random(1, 3));
                var rand = 1;
                if (rand == 1) {
                    echoChange = str.replace(/[aeiou]/ig, '');
                }
                else if (rand == 2) {
                }
                else if (rand == 3) {
                }
            }

            function wordCheck() {
                if (test) {
                    return true;
                }
                return false;
            }

            //Not implemented
            function randWord() {
                var func = randCase();
                if (func == 1) {
                    echoChange = "yyo";
                }
            }

            //Creates a new line with just a '>' when enter is pressed and there is no input
            function keyPressed() {
                if (keyCode == ENTER && input.value() == '') {
                    createRow('>');
                }
            }

            //Rand Function
            function randCase() {
                var rand = Math.trunc(random(1, 3));
                return rand;
            }

            //Outputs 'str' 
            function echoCom(str) {
                if (str.length > 35) {
                    createRow('>Error: Word to long to echo!')
                }
                else {
                    createRow('>' + str);
                }
            }

            //Outputs a help menu for commands
            function helpCom() {
                createRow('*** HELP MENU **************************');
                createRow('*echo [message] - Returns message typed');
                createRow('*clear - Clears the terminal window');
                createRow('*text vowels - returns vowels to word')
            }

            //Clears the terminal - removes all elements created and creates new ones
            function clearCom() {
                termTable.remove();
                tableDiv.remove();
                input.remove();
                placeHolder.remove();

                termTable = createElement('table');
                termTable.parent('console');

                placeHolder = createP('>');
                placeHolder.parent('console');

                tableDiv = createDiv();
                tableDiv.parent('console');
                tableDiv.id('bar');

                input = createInput();
                input.parent(tableDiv);

                input.elt.focus();

                input.changed(terminal);
            }

            //Outputs an error message if no command leads the input message
            function notCom(str) {
                if (str.length > 30) {
                    str = str.substring(0, 30) + "..."
                }
                if (str == '') {
                    createRow('>');
                }
                else {
                    createRow('>Error: \'' + str + '\' is not a command!');
                }
            }

            //
            function changeWord() {
                var rand = Math.trunc(random(1, 3));
            }
        </script>
    </div>
</body>
